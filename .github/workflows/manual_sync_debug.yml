name: Manual Trinity Debugger

on:
  workflow_dispatch: # á€™á€„á€ºá€¸á€€á€­á€¯á€šá€ºá€á€­á€¯á€„á€º á€á€œá€¯á€á€ºá€”á€¾á€­á€•á€ºá€™á€¾ Run á€™á€šá€º
  schedule:
    # á† á€”á€¬á€›á€®á€á€¼á€¬á€¸ á€á€…á€ºá€á€« (á€á€…á€ºá€”á€±á€· á„ á€€á€¼á€­á€™á€º) á€¡á€œá€­á€¯á€¡á€œá€»á€±á€¬á€€á€º Sync á€œá€¯á€•á€ºá€•á€±á€¸á€™á€šá€º
    # á€’á€«á€€ GitHub Free Minutes á€€á€­á€¯ á€¡á€œá€½á€”á€ºá€¡á€€á€»á€½á€¶ á€™á€€á€¯á€”á€ºá€…á€±á€˜á€² Phase 3 á€€á€­á€¯ Live á€–á€¼á€…á€ºá€…á€±á€•á€«á€á€šá€º
    - cron: '0 */6 * * *'

# ğŸ›  á€¡á€›á€±á€¸á€€á€¼á€®á€¸á€†á€¯á€¶á€¸á€¡á€•á€­á€¯á€„á€ºá€¸ - GitHub á€€á€­á€¯ á€–á€­á€¯á€„á€ºá€á€½á€± á€›á€±á€¸á€á€½á€„á€·á€º (Write Permission) á€•á€±á€¸á€œá€­á€¯á€€á€ºá€á€¬á€•á€«
permissions:
  contents: write
  pages: write
  id-token: write

# á€á€…á€ºá€•á€¼á€­á€¯á€„á€ºá€á€Šá€ºá€¸ Workflow á€á€½á€± á€¡á€™á€»á€¬á€¸á€€á€¼á€®á€¸á€á€€á€ºá€•á€¼á€®á€¸ Limit á€™á€€á€»á€±á€¬á€ºá€¡á€±á€¬á€„á€º á€‘á€­á€”á€ºá€¸á€•á€±á€¸á€á€²á€· á€¡á€•á€­á€¯á€„á€ºá€¸
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  debug_sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          submodules: false
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Dependencies
        run: npm install pg @supabase/supabase-js firebase-admin

      - name: Force Sync Neon to Supabase
        env:
          # Database & Firebase Keys
          NEON_KEY: ${{ secrets.NEON_KEY }}
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_SERVICE_ROLE_KEY: ${{ secrets.SUPABASE_SERVICE_ROLE_KEY }}
          FIREBASE_KEY: ${{ secrets.FIREBASE_KEY }}
          
          # GitHub Authentication (PAT á€á€­á€¯á€·á€™á€Ÿá€¯á€á€º GITHUB_TOKEN)
          # 'GH_TOKEN' á€”á€²á€· 'GITHUB_TOKEN' á€”á€¾á€…á€ºá€™á€»á€­á€¯á€¸á€œá€¯á€¶á€¸á€€á€­á€¯ delta_sync.js á€€ á€á€±á€«á€ºá€á€¯á€¶á€¸á€”á€­á€¯á€„á€ºá€¡á€±á€¬á€„á€º á€‘á€Šá€·á€ºá€•á€±á€¸á€‘á€¬á€¸á€•á€«á€á€šá€º
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
        run: node delta_sync.js
