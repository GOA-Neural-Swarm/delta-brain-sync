name: Sovereign AI Multi-Cloud Sync (Neon + GitHub + Kaggle)

on:
  schedule:
    - cron: '0 * * * *' # တစ်နာရီတစ်ကြိမ် အလိုအလျောက် ပတ်မည်
  workflow_dispatch:      # Manual ခလုတ်နှိပ်ပြီး နှိုး၍လည်းရသည်

jobs:
  sync_and_trigger:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          token: ${{ secrets.GH_TOKEN }} # Authenticated Access

      # --- ၁။ Python Environment Setup ---
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      - name: Install Dependencies
        run: pip install -r requirements.txt

      # --- ၂။ Neon Sync (ai_status.json ကို Update လုပ်ခြင်း) ---
      - name: Run Neon Sync Script
        env:
          NEON_URL: ${{ secrets.NEON_URL }}
        run: python sync_data.py

      # --- ၃။ GitHub Auto-Commit (မူလအတိုင်း Token သုံး၍ Push ပြုလုပ်ခြင်း) ---
      - name: Commit AI Status to Repository
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git
          git config --global user.name 'Sovereign-AI-Bot'
          git config --global user.email 'bot@sovereign.ai'
          git add ai_status.json
          git commit -m "Phase 6 Data Sync: $(date)" || exit 0
          git push

      # --- ၄။ Kaggle Brain Trigger (Llama-3 GPU ကို နှိုးဆော်ခြင်း) ---
      - name: Setup Kaggle API
        run: pip install kaggle

      - name: Trigger Kaggle Neural Evolution
        env:
          KAGGLE_USERNAME: ${{ secrets.KAGGLE_USERNAME }}
          KAGGLE_KEY: ${{ secrets.KAGGLE_KEY }}
        run: |
          mkdir -p ~/.kaggle
          echo "{\"username\":\"$KAGGLE_USERNAME\",\"key\":\"$KAGGLE_KEY\"}" > ~/.kaggle/kaggle.json
          chmod 600 ~/.kaggle/kaggle.json
          # kaggle_brain folder ထဲက ကုဒ်များကို Kaggle ဆီ တွန်းပို့ပြီး Run စေမည်
          kaggle kernels push -p ./kaggle_brain
