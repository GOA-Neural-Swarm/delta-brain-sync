name: Sovereign AI Multi-Cloud Sync (Neon + GitHub + Kaggle)

on:
  schedule:
    - cron: '0 * * * *'
  workflow_dispatch:

jobs:
  sync_and_trigger:
    runs-on: ubuntu-latest
    steps:
      - name: Step 1 - Checkout
        uses: actions/checkout@v4 # v4 သို့ Upgrade လုပ်ထားသည်
        with:
          token: ${{ secrets.GH_TOKEN }}

      # --- ၁။ Python Environment Setup (Unified to 3.10) ---
      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # 3.9 မှ 3.10 သို့ ညှိလိုက်သည်

      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install kaggle psycopg2-binary requests # လိုအပ်သည်များကို စုစည်းထားသည်
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # --- ၂။ Neon Sync ---
      - name: Run Neon Sync Script
        env:
          NEON_URL: ${{ secrets.NEON_URL }}
        run: python sync_data.py

      # --- ၃။ GitHub Auto-Commit ---
      - name: Commit AI Status to Repository
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          git remote set-url origin https://x-access-token:${GITHUB_TOKEN}@github.com/${{ github.repository }}.git
          git config --global user.name 'Sovereign-AI-Bot'
          git config --global user.email 'bot@sovereign.ai'
          git add ai_status.json || echo "No ai_status.json found"
          git commit -m "Phase 6 Data Sync: $(date)" || exit 0
          git push

      # --- ၄။ Kaggle Brain Trigger ---
      - name: Trigger Kaggle Neural Evolution
        env:
          KAGGLE_USERNAME: ${{ secrets.KAGGLE_USERNAME }}
          KAGGLE_KEY: ${{ secrets.KAGGLE_KEY }}
        run: |
          mkdir -p ~/.kaggle
          echo "{\"username\":\"$KAGGLE_USERNAME\",\"key\":\"$KAGGLE_KEY\"}" > ~/.kaggle/kaggle.json
          chmod 600 ~/.kaggle/kaggle.json
          if [ -d "kaggle_brain" ]; then
            kaggle kernels push -p ./kaggle_brain
          else
            print "Directory kaggle_brain not found"
          fi
          
