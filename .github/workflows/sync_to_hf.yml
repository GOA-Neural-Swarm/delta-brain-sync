name: Sync to Hugging Face
on:
  push:
    branches: [main] # Main branch á€™á€¾á€¬ push á€œá€¯á€•á€ºá€á€­á€¯á€„á€ºá€¸ á€¡á€œá€¯á€•á€ºá€œá€¯á€•á€ºá€™á€šá€º

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0
          lfs: true

      # áá‹ ğŸ”± PUSH CODE TO HF (HEADER INJECTION METHOD)
      - name: Push Code to HF
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
        run: |
          # Git Identity á€á€á€ºá€™á€¾á€á€ºá€á€¼á€„á€ºá€¸
          git config --global user.email "commander@goa.com"
          git config --global user.name "TELEFOXX"
          
          # Auth Header á€€á€­á€¯ Git Config á€‘á€² á€á€­á€¯á€€á€ºá€›á€­á€¯á€€á€ºá€‘á€Šá€·á€ºá€á€¼á€„á€ºá€¸ (á€‚á€­á€á€ºá€†á€¯á€¶á€¸á€”á€Šá€ºá€¸á€œá€™á€ºá€¸)
          git config --global http."https://huggingface.co/".extraheader "AUTHORIZATION: Bearer ${{ secrets.HF_TOKEN }}"
          
          # Remote URL á€€á€­á€¯ á€¡á€á€”á€·á€ºá€›á€¾á€„á€ºá€¸á€†á€¯á€¶á€¸ format á€”á€²á€· á€•á€¼á€”á€ºá€•á€¼á€„á€ºá€á€¼á€„á€ºá€¸
          git remote set-url origin https://huggingface.co/spaces/TELEFOXX/GOA
          
          # Force Push á€œá€¯á€•á€ºá€™á€šá€º
          git push --force origin main

      # á‚á‹ ğŸ”± SYNC SECRETS TO HF SPACE (API METHOD)
      - name: Sync Secrets to HF
        run: |
          curl -X POST https://huggingface.co/api/spaces/TELEFOXX/GOA/variables \
            -H "Authorization: Bearer ${{ secrets.HF_TOKEN }}" \
            -H "Content-Type: application/json" \
            -d '{
              "variables": [
                {"key": "DATABASE_URL", "value": "${{ secrets.DATABASE_URL }}"},
                {"key": "SUPABASE_URL", "value": "${{ secrets.SUPABASE_URL }}"},
                {"key": "SUPABASE_KEY", "value": "${{ secrets.SUPABASE_KEY }}"},
                {"key": "GROQ_API_KEY", "value": "${{ secrets.GROQ_API_KEY }}"},
                {"key": "FIREBASE_CONFIG", "value": "${{ secrets.FIREBASE_CONFIG }}"}
              ]
            }'
            
